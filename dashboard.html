<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dashboard</title>
  <style>
    body { font-family: Arial; text-align: center; margin-top: 50px; }
    .gallery img { width: 200px; margin: 10px; border-radius: 8px; }
  </style>
</head>
<body>
  <h2>Welcome to Dashboard</h2>
  <input type="file" id="fileInput">
  <button onclick="upload()">Upload Foto</button>

  <h3>Galeri Foto</h3>
  <div class="gallery" id="gallery"></div>

  <script>
    const username = new URLSearchParams(window.location.search).get("user");

    async function upload() {
      const fileInput = document.getElementById("fileInput");
      if (!fileInput.files[0]) return alert("Pilih file dulu!");

      const formData = new FormData();
      formData.append("file", fileInput.files[0]);
      formData.append("username", username);

      const res = await fetch("/api/upload", {
        method: "POST",
        body: formData
      });
      if (res.ok) {
        alert("Upload sukses!");
        loadGallery();
      } else {
        alert("Upload gagal");
      }
    }

    async function loadGallery() {
      const res = await fetch("/api/listUploads");
      const data = await res.json();
      const gal = document.getElementById("gallery");
      gal.innerHTML = "";
      data.files.forEach(f => {
        const img = document.createElement("img");
        img.src = f;
        gal.appendChild(img);
      });
    }

    loadGallery();
  </script>
</body>
</html>
